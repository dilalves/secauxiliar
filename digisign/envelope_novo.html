<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Novo Envelope • DigiSign</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* (estilo igual do painel/admin) */
body { margin:0; font-family:Arial; background:#f3f4f6; }
.container { max-width:700px; margin:40px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.1); }
h1 { margin:0 0 20px; }
label { display:block; font-size:.9rem; margin:10px 0 6px; }
input[type="text"], input[type="file"] {
    width:100%; padding:10px; border-radius:8px;
    border:1px solid #ccc; font-size:1rem;
}
button {
    margin-top:20px; background:#0b3b78; color:#fff;
    padding:12px 20px; border:none; border-radius:8px;
    cursor:pointer; font-size:1rem;
}
button:hover { filter:brightness(1.1); }
.msg { margin-top:15px; padding:12px; border-radius:8px; display:none; }
.msg.ok { background:#dcfce7; color:#166534; }
.msg.err { background:#fee2e2; color:#b91c1c; }
</style>
</head>

<body>
<div class="container">
  <h1>Novo Envelope</h1>

  <label>Título do documento</label>
  <input type="text" id="titulo" placeholder="Ex: Contrato de matrícula">

  <label>Arquivo PDF</label>
  <input type="file" id="pdf" accept="application/pdf">

  <button id="btnCriar">Criar Envelope</button>

  <div class="msg" id="mensagem"></div>
</div>

<script>
const API_BASE = 'https://apisec.secauxiliar.com.br/digisign';

document.getElementById('btnCriar').onclick = async () => {
  const titulo = document.getElementById('titulo').value.trim();
  const pdf = document.getElementById('pdf').files[0];
  const msg = document.getElementById('mensagem');

  msg.style.display = 'none';

  if (!titulo || !pdf) {
    msg.className = 'msg err';
    msg.textContent = 'Preencha o título e escolha um PDF.';
    msg.style.display = 'block';
    return;
  }

  const form = new FormData();
  form.append('titulo', titulo);
  form.append('pdf', pdf);

  const token = localStorage.getItem('zs_token');

  try {
    const resp = await fetch(API_BASE + '/envelope_create.php', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + token
      },
      body: form
    });

    const data = await resp.json();

    if (!data.ok) {
      msg.className = 'msg err';
      msg.textContent = data.error;
      msg.style.display = 'block';
      return;
    }

    msg.className = 'msg ok';
    msg.innerHTML = 'Envelope criado!<br>ID: ' + data.envelope_id;

    setTimeout(() => {
      window.location.href = 'envelope_dest.html?id=' + data.envelope_id;
    }, 1500);

  } catch (err) {
    msg.className = 'msg err';
    msg.textContent = 'Erro ao conectar ao servidor.';
    msg.style.display = 'block';
  }
};
</script>
</body>
</html>
