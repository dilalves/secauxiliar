<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Login • DigiSign</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg:#0b3b78;         /* azul Objetivo */
      --card:#ffffff;
      --input-border:#cbd5e1;
      --muted:#6b7280;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      color:#0f172a;
    }
    .card{
      background:var(--card);
      border-radius:16px;
      box-shadow:0 16px 40px rgba(15,23,42,.4);
      padding:24px 28px;
      width:100%;
      max-width:380px;
    }
    h1{
      margin:0 0 4px;
      font-size:1.4rem;
    }
    .subtitle{
      font-size:.9rem;
      color:var(--muted);
      margin-bottom:16px;
    }
    label{
      display:block;
      font-size:.8rem;
      margin:8px 0 4px;
      color:#0f172a;
    }
    input[type="email"],
    input[type="password"]{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid var(--input-border);
      font-size:.9rem;
    }
    button{
      width:100%;
      margin-top:16px;
      padding:10px 12px;
      border-radius:999px;
      border:none;
      background:#0b3b78;
      color:#fff;
      font-weight:600;
      cursor:pointer;
      font-size:.95rem;
    }
    button:hover{
      filter:brightness(1.05);
    }
    .erro{
      background:#fee2e2;
      color:#b91c1c;
      border-radius:8px;
      padding:8px 10px;
      font-size:.8rem;
      margin-bottom:10px;
      display:none;
    }
    .brand{
      font-size:.8rem;
      color:#e5e7eb;
      text-align:center;
      margin-top:12px;
      position:fixed;
      bottom:8px;
      left:0;
      right:0;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>DigiSign</h1>
    <div class="subtitle">Painel de assinaturas • Curso Objetivo</div>

    <div id="erro" class="erro"></div>

    <form id="formLogin">
      <label for="email">E-mail</label>
      <input type="email" id="email" name="email" required autofocus>

      <label for="senha">Senha</label>
      <input type="password" id="senha" name="senha" required>

      <button type="submit">Entrar</button>
    </form>
  </div>

  <div class="brand">
    3A Sistemas • Curso Objetivo
  </div>

  <script>
    const API_BASE = 'https://apisec.secauxiliar.com.br/digisign';

    // Se já estiver logado, pula o login e vai pro painel
    const tokenExistente = localStorage.getItem('zs_token');
    const userExistente = localStorage.getItem('zs_user');
    if (tokenExistente && userExistente) {
      window.location.href = 'admin.html';
    }

    const form = document.getElementById('formLogin');
    const divErro = document.getElementById('erro');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      divErro.style.display = 'none';
      divErro.textContent = '';

      const email = document.getElementById('email').value.trim();
      const senha = document.getElementById('senha').value;

      try {
        const resp = await fetch(API_BASE + '/auth_login.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ email, senha })
        });

        const data = await resp.json().catch(() => ({}));

        if (!resp.ok || !data.ok) {
          divErro.textContent = data.error || 'Falha no login.';
          divErro.style.display = 'block';
          return;
        }

        // Guarda token e dados do usuário
        localStorage.setItem('zs_token', data.token);
        localStorage.setItem('zs_user', JSON.stringify(data.user));

        window.location.href = 'admin.html';
      } catch (err) {
        console.error(err);
        divErro.textContent = 'Erro ao conectar com o servidor.';
        divErro.style.display = 'block';
      }
    });
  </script>
</body>
</html>
